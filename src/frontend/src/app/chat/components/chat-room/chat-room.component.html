<div class="chatbox" *ngIf="(chatRoom | json) != ({} | json)">
    <!-- RoomUsers -->
    <div class="chatbox-roomuser">
      <div class="chatbox-roomuser-items">
        <div class="chatbox-roomuser-item" *ngFor="let roomUser of (roomUsers)" (mouseenter)="roomUser.showButtons = true" (mouseleave)="roomUser.showButtons = false">
          <!-- User info -->
          <img (click)="openProfile(username)" *ngIf="!roomUser.showButtons || roomUser.username == username" class="chatbox-roomuser-item-avatar" avatar username="{{ roomUser.username }}">
          <p *ngIf="!roomUser.showButtons || roomUser.username == username">{{ roomUser.username }}</p>

          <!-- Buttons -->
          <!-- Profil button -->
          <svg (click)="openProfile(roomUser.username)" class="chatbox-roomuser-item-button" *ngIf="roomUser.showButtons && roomUser.username != username" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 9C11.1755 9 12.9375 7.23797 12.9375 5.0625C12.9375 2.88703 11.1755 1.125 9 1.125C6.82453 1.125 5.0625 2.88703 5.0625 5.0625C5.0625 7.23797 6.82453 9 9 9ZM9 10.9688C6.37172 10.9688 1.125 12.2878 1.125 14.9062V14.9062C1.125 15.9936 2.00644 16.875 3.09375 16.875H14.9062C15.9936 16.875 16.875 15.9936 16.875 14.9062V14.9062C16.875 12.2878 11.6283 10.9688 9 10.9688Z"/>
          </svg>

          <!-- Add / Remove friends-->
          <!-- Add -->
          <svg (click)="socialService.friendUser(roomUser.username)" class="chatbox-roomuser-item-button add" *ngIf="roomUser.showButtons && roomUser.username != username && (socialService.checkUserRelation(username, roomUser.username) === 'none' || socialService.checkUserRelation(username, roomUser.username) === 'blocked')" width="18" height="18" viewBox="0 0 18 18" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14.3448 6.51724C14.3448 7.9805 13.7635 9.38384 12.7289 10.4185C11.6942 11.4532 10.2908 12.0345 8.82759 12.0345C7.36432 12.0345 5.96099 11.4532 4.92631 10.4185C3.89162 9.38384 3.31034 7.9805 3.31034 6.51724C3.31034 5.05398 3.89162 3.65065 4.92631 2.61596C5.96099 1.58128 7.36432 1 8.82759 1C10.2908 1 11.6942 1.58128 12.7289 2.61596C13.7635 3.65065 14.3448 5.05398 14.3448 6.51724ZM22.069 9.82759C20.8896 9.8267 19.7165 9.9977 18.5865 10.3352C18.0783 9.68316 17.7635 8.90155 17.6778 8.07936C17.5922 7.25717 17.7391 6.42745 18.1019 5.68469C18.4648 4.94193 19.0289 4.31598 19.73 3.87814C20.4312 3.4403 21.2412 3.20816 22.0679 3.20816C22.8945 3.20816 23.7045 3.4403 24.4057 3.87814C25.1069 4.31598 25.671 4.94193 26.0338 5.68469C26.3966 6.42745 26.5436 7.25717 26.4579 8.07936C26.3722 8.90155 26.0574 9.68316 25.5492 10.3352C24.4199 9.99791 23.2475 9.82692 22.069 9.82759ZM3.31034 14.2414H12.7051C10.908 16.4138 9.92674 19.1461 9.93103 21.9655C9.93103 22.7026 9.99724 23.4221 10.123 24.1217C9.69207 24.156 9.25991 24.1729 8.82759 24.1724C0 24.1724 0 17.7172 0 17.7172V17.5517C0 16.6738 0.348768 15.8318 0.969578 15.211C1.59039 14.5901 2.43239 14.2414 3.31034 14.2414ZM32 21.9655C32 24.5994 30.9537 27.1254 29.0913 28.9878C27.2288 30.8502 24.7028 31.8966 22.069 31.8966C19.4351 31.8966 16.9091 30.8502 15.0467 28.9878C13.1842 27.1254 12.1379 24.5994 12.1379 21.9655C12.1379 19.3316 13.1842 16.8056 15.0467 14.9432C16.9091 13.0808 19.4351 12.0345 22.069 12.0345C24.7028 12.0345 27.2288 13.0808 29.0913 14.9432C30.9537 16.8056 32 19.3316 32 21.9655ZM23.1724 17.5517C23.1724 17.2591 23.0562 16.9784 22.8492 16.7715C22.6423 16.5645 22.3616 16.4483 22.069 16.4483C21.7763 16.4483 21.4956 16.5645 21.2887 16.7715C21.0818 16.9784 20.9655 17.2591 20.9655 17.5517V20.8621H17.6552C17.3625 20.8621 17.0819 20.9783 16.8749 21.1853C16.668 21.3922 16.5517 21.6729 16.5517 21.9655C16.5517 22.2582 16.668 22.5388 16.8749 22.7458C17.0819 22.9527 17.3625 23.069 17.6552 23.069H20.9655V26.3793C20.9655 26.672 21.0818 26.9526 21.2887 27.1596C21.4956 27.3665 21.7763 27.4828 22.069 27.4828C22.3616 27.4828 22.6423 27.3665 22.8492 27.1596C23.0562 26.9526 23.1724 26.672 23.1724 26.3793V23.069H26.4828C26.7754 23.069 27.0561 22.9527 27.263 22.7458C27.47 22.5388 27.5862 22.2582 27.5862 21.9655C27.5862 21.6729 27.47 21.3922 27.263 21.1853C27.0561 20.9783 26.7754 20.8621 26.4828 20.8621H23.1724V17.5517Z"/>
          </svg>
          <!-- Remove -->
          <svg (click)="socialService.unfriendUser(roomUser.username)" class="chatbox-roomuser-item-button remove" *ngIf="roomUser.showButtons && roomUser.username != username && socialService.checkUserRelation(username, roomUser.username) === 'friend'" width="18" height="18" viewBox="0 0 18 18" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
            <path d="M16 9C16 10.3261 15.4732 11.5979 14.5355 12.5355C13.5979 13.4732 12.3261 14 11 14C9.67392 14 8.40215 13.4732 7.46447 12.5355C6.52678 11.5979 6 10.3261 6 9C6 7.67392 6.52678 6.40215 7.46447 5.46447C8.40215 4.52678 9.67392 4 11 4C12.3261 4 13.5979 4.52678 14.5355 5.46447C15.4732 6.40215 16 7.67392 16 9V9ZM23 12C21.9312 11.9992 20.8681 12.1542 19.844 12.46C19.3835 11.8691 19.0982 11.1608 19.0205 10.4157C18.9429 9.67056 19.0761 8.91863 19.4049 8.2455C19.7337 7.57237 20.2449 7.00511 20.8803 6.60831C21.5158 6.21152 22.2499 6.00114 22.999 6.00114C23.7481 6.00114 24.4822 6.21152 25.1177 6.60831C25.7531 7.00511 26.2643 7.57237 26.5931 8.2455C26.9219 8.91863 27.0551 9.67056 26.9775 10.4157C26.8998 11.1608 26.6145 11.8691 26.154 12.46C25.1306 12.1544 24.0681 11.9994 23 12V12ZM6 16H14.514C12.8854 17.9688 11.9961 20.4449 12 23C12 23.668 12.06 24.32 12.174 24.954C11.7834 24.9851 11.3918 25.0004 11 25C3 25 3 19.15 3 19.15V19C3 18.2044 3.31607 17.4413 3.87868 16.8787C4.44129 16.3161 5.20435 16 6 16V16ZM14 23C14 25.3869 14.9482 27.6761 16.636 29.364C18.3239 31.0518 20.6131 32 23 32C25.3869 32 27.6761 31.0518 29.364 29.364C31.0518 27.6761 32 25.3869 32 23C32 20.6131 31.0518 18.3239 29.364 16.636C27.6761 14.9482 25.3869 14 23 14C20.6131 14 18.3239 14.9482 16.636 16.636C14.9482 18.3239 14 20.6131 14 23V23ZM16 23C16 21.7009 16.3615 20.4274 17.0441 19.322C17.7267 18.2166 18.7035 17.3231 19.865 16.7412C21.0266 16.1594 22.3272 15.9123 23.6212 16.0276C24.9152 16.1429 26.1516 16.616 27.192 17.394L17.392 27.194C16.4853 25.9841 15.9967 24.512 16 23V23ZM23 30C21.428 30 19.976 29.48 18.808 28.606L28.608 18.806C29.3867 19.8465 29.8603 21.0833 29.9758 22.3778C30.0913 23.6723 29.8442 24.9734 29.262 26.1354C28.6799 27.2974 27.7858 28.2744 26.6798 28.9569C25.5738 29.6395 24.2996 30.0007 23 30V30Z"/>
          </svg>

          <!-- Block -->
          <svg class="chatbox-roomuser-item-button" *ngIf="roomUser.showButtons && roomUser.username != username" width="18" height="18" viewBox="0 0 18 18" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15.5429 6.94286C15.5429 8.519 14.9167 10.0306 13.8022 11.1451C12.6877 12.2596 11.1761 12.8857 9.6 12.8857C8.02386 12.8857 6.51227 12.2596 5.39777 11.1451C4.28326 10.0306 3.65714 8.519 3.65714 6.94286C3.65714 5.36671 4.28326 3.85512 5.39777 2.74062C6.51227 1.62612 8.02386 1 9.6 1C11.1761 1 12.6877 1.62612 13.8022 2.74062C14.9167 3.85512 15.5429 5.36671 15.5429 6.94286ZM17.3714 22.8496C16.0219 24.3673 13.6777 25.6857 9.6 25.6857C0 25.6857 0 18.3714 0 18.3714C0 17.4015 0.385305 16.4713 1.07115 15.7854C1.757 15.0996 2.68721 14.7143 3.65714 14.7143H15.5429C16.5128 14.7143 17.443 15.0996 18.1288 15.7854C18.8147 16.4713 19.2 17.4015 19.2 18.3714C19.2 18.3714 19.2 18.5634 19.1598 18.8834C18.6144 19.2074 18.1627 19.6678 17.8492 20.2192C17.5356 20.7707 17.371 21.3942 17.3714 22.0286V22.8496ZM23.7714 12.8857C24.9838 12.8857 26.1466 12.4041 27.0039 11.5468C27.8612 10.6895 28.3429 9.5267 28.3429 8.31429C28.3429 7.10187 27.8612 5.93911 27.0039 5.0818C26.1466 4.22449 24.9838 3.74286 23.7714 3.74286C22.559 3.74286 21.3962 4.22449 20.5389 5.0818C19.6816 5.93911 19.2 7.10187 19.2 8.31429C19.2 9.5267 19.6816 10.6895 20.5389 11.5468C21.3962 12.4041 22.559 12.8857 23.7714 12.8857ZM21.9429 18.3714V20.2H21.0286C20.5436 20.2 20.0785 20.3927 19.7356 20.7356C19.3927 21.0785 19.2 21.5436 19.2 22.0286V29.3429C19.2 29.8278 19.3927 30.2929 19.7356 30.6359C20.0785 30.9788 20.5436 31.1714 21.0286 31.1714H30.1714C30.6564 31.1714 31.1215 30.9788 31.4644 30.6359C31.8073 30.2929 32 29.8278 32 29.3429V22.0286C32 21.5436 31.8073 21.0785 31.4644 20.7356C31.1215 20.3927 30.6564 20.2 30.1714 20.2H29.2571V18.3714C29.2571 17.4015 28.8718 16.4713 28.186 15.7854C27.5001 15.0996 26.5699 14.7143 25.6 14.7143C24.6301 14.7143 23.6999 15.0996 23.014 15.7854C22.3282 16.4713 21.9429 17.4015 21.9429 18.3714ZM23.7714 20.2V18.3714C23.7714 17.8865 23.9641 17.4214 24.307 17.0784C24.6499 16.7355 25.115 16.5429 25.6 16.5429C26.085 16.5429 26.5501 16.7355 26.893 17.0784C27.2359 17.4214 27.4286 17.8865 27.4286 18.3714V20.2H23.7714ZM25.6 24.3143C25.9637 24.3143 26.3126 24.4588 26.5697 24.716C26.8269 24.9732 26.9714 25.322 26.9714 25.6857C26.9714 26.0494 26.8269 26.3983 26.5697 26.6555C26.3126 26.9127 25.9637 27.0571 25.6 27.0571C25.2363 27.0571 24.8874 26.9127 24.6303 26.6555C24.3731 26.3983 24.2286 26.0494 24.2286 25.6857C24.2286 25.322 24.3731 24.9732 24.6303 24.716C24.8874 24.4588 25.2363 24.3143 25.6 24.3143Z"/>
          </svg>
        </div>
      </div>
    </div>

    <div class="chatbox-chat">
      <!--Messages-->
      <div class="chatbox-messages" #msgs>
          <div *ngFor="let message of messages.reverse()">
              <app-chat-message class="chatbox-messages-app" [message]="message"></app-chat-message>
          </div>
      </div>

      <!-- Input-->
      <div class="chatbox-input" *ngIf="(roomUsers)?.length; else password">
        <!-- Input -->
        <input class="chatbox-input-form" [formControl]="chatMessage" type="text" (keyup.enter)="sendMessage()">
        <!-- Send button -->
        <button class="chatbox-input-button" [disabled]="!chatMessage.valid && chatRoom" (click)="sendMessage()">
          <svg class="chatbox-input-button-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 2L11 13M22 2L15 22L11 13L2 9L22 2Z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <!-- Password -->
      <ng-template #password>
        <div class="chatbox-password">
          <input class="chatbox-password-input" type="password" [formControl]="pass" (keyup.enter)="joinProtectedRoom()" required>
          <button class="chatbox-password-button " [disabled]="!pass.valid" (click)="joinProtectedRoom()">
            <svg class="chatbox-password-button-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1.5 8.25C1.5 7.25544 1.89509 6.30161 2.59835 5.59835C3.30161 4.89509 4.25544 4.5 5.25 4.5H18.75C19.7446 4.5 20.6984 4.89509 21.4017 5.59835C22.1049 6.30161 22.5 7.25544 22.5 8.25V14.25C22.5 14.7425 22.403 15.2301 22.2145 15.6851C22.0261 16.14 21.7499 16.5534 21.4017 16.9017C21.0534 17.2499 20.64 17.5261 20.1851 17.7145C19.7301 17.903 19.2425 18 18.75 18H5.25C4.25544 18 3.30161 17.6049 2.59835 16.9017C1.89509 16.1984 1.5 15.2446 1.5 14.25V8.25ZM7.719 9.219L6.75 10.1895L5.781 9.219C5.71127 9.14927 5.62848 9.09395 5.53738 9.05621C5.44627 9.01848 5.34862 8.99905 5.25 8.99905C5.15138 8.99905 5.05373 9.01848 4.96262 9.05621C4.87152 9.09395 4.78873 9.14927 4.719 9.219C4.64927 9.28873 4.59395 9.37152 4.55622 9.46262C4.51848 9.55373 4.49905 9.65138 4.49905 9.75C4.49905 9.84862 4.51848 9.94627 4.55622 10.0374C4.59395 10.1285 4.64927 10.2113 4.719 10.281L5.6895 11.25L4.719 12.219C4.64927 12.2887 4.59395 12.3715 4.55622 12.4626C4.51848 12.5537 4.49905 12.6514 4.49905 12.75C4.49905 12.8486 4.51848 12.9463 4.55622 13.0374C4.59395 13.1285 4.64927 13.2113 4.719 13.281C4.85983 13.4218 5.05084 13.5009 5.25 13.5009C5.34862 13.5009 5.44627 13.4815 5.53738 13.4438C5.62848 13.406 5.71127 13.3507 5.781 13.281L6.75 12.3105L7.719 13.281C7.78873 13.3507 7.87152 13.406 7.96262 13.4438C8.05373 13.4815 8.15138 13.5009 8.25 13.5009C8.34862 13.5009 8.44627 13.4815 8.53738 13.4438C8.62848 13.406 8.71127 13.3507 8.781 13.281C8.85073 13.2113 8.90605 13.1285 8.94379 13.0374C8.98152 12.9463 9.00095 12.8486 9.00095 12.75C9.00095 12.6514 8.98152 12.5537 8.94379 12.4626C8.90605 12.3715 8.85073 12.2887 8.781 12.219L7.8105 11.25L8.781 10.281C8.85073 10.2113 8.90605 10.1285 8.94379 10.0374C8.98152 9.94627 9.00095 9.84862 9.00095 9.75C9.00095 9.65138 8.98152 9.55373 8.94379 9.46262C8.90605 9.37152 8.85073 9.28873 8.781 9.219C8.71127 9.14927 8.62848 9.09395 8.53738 9.05621C8.44627 9.01848 8.34862 8.99905 8.25 8.99905C8.15138 8.99905 8.05373 9.01848 7.96262 9.05621C7.87152 9.09395 7.78873 9.14927 7.719 9.219V9.219ZM13.719 9.219L12.75 10.1895L11.781 9.219C11.7113 9.14927 11.6285 9.09395 11.5374 9.05621C11.4463 9.01848 11.3486 8.99905 11.25 8.99905C11.1514 8.99905 11.0537 9.01848 10.9626 9.05621C10.8715 9.09395 10.7887 9.14927 10.719 9.219C10.6493 9.28873 10.594 9.37152 10.5562 9.46262C10.5185 9.55373 10.4991 9.65138 10.4991 9.75C10.4991 9.84862 10.5185 9.94627 10.5562 10.0374C10.594 10.1285 10.6493 10.2113 10.719 10.281L11.6895 11.25L10.719 12.219C10.6493 12.2887 10.594 12.3715 10.5562 12.4626C10.5185 12.5537 10.4991 12.6514 10.4991 12.75C10.4991 12.8486 10.5185 12.9463 10.5562 13.0374C10.594 13.1285 10.6493 13.2113 10.719 13.281C10.8598 13.4218 11.0508 13.5009 11.25 13.5009C11.3486 13.5009 11.4463 13.4815 11.5374 13.4438C11.6285 13.406 11.7113 13.3507 11.781 13.281L12.75 12.3105L13.719 13.281C13.8598 13.4218 14.0508 13.5009 14.25 13.5009C14.4492 13.5009 14.6402 13.4218 14.781 13.281C14.9218 13.1402 15.0009 12.9492 15.0009 12.75C15.0009 12.5508 14.9218 12.3598 14.781 12.219L13.8105 11.25L14.781 10.281C14.9218 10.1402 15.0009 9.94916 15.0009 9.75C15.0009 9.55084 14.9218 9.35983 14.781 9.219C14.6402 9.07817 14.4492 8.99905 14.25 8.99905C14.0508 8.99905 13.8598 9.07817 13.719 9.219V9.219ZM16.5 12.75C16.5 12.9489 16.579 13.1397 16.7197 13.2803C16.8603 13.421 17.0511 13.5 17.25 13.5H18.75C18.9489 13.5 19.1397 13.421 19.2803 13.2803C19.421 13.1397 19.5 12.9489 19.5 12.75C19.5 12.5511 19.421 12.3603 19.2803 12.2197C19.1397 12.079 18.9489 12 18.75 12H17.25C17.0511 12 16.8603 12.079 16.7197 12.2197C16.579 12.3603 16.5 12.5511 16.5 12.75Z"/>
            </svg>
          </button>
        </div>
      </ng-template>
    </div>

</div>
